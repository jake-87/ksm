# The KSM language spec

Read this in raw mode.

## part 1: the vm

### registers

there are 8 registers: r1 through r8. They occupy the reserved memory locations 01 - 08, with 00 being the program counter.

### opcodes

Opcodes are formed by a sequence of 8 bytes, like so:

`02 b7 55 00`

The first is the opcode, the other three are operands.

### types of opcodes

If the argument should be left blank, it is signified with zeros.

### Modes:

01 - Memory -> memory, reg -> memory, reg -> reg, etc

02 - Literal -> memory, literal -> reg

### Conventions:

xx, yy, zz -> Arguments

mm -> Mode

## Opcodes

00 xx yy mm -> mov des src mode

01 xx yy mm -> inc src

02 xx yy mm -> dec src

03 xx yy mm -> add arg1 arg2 mode, result in r1

04 xx yy mm -> sub arg1 arg2 mode, result in r1

05 xx yy mm -> mul arg1 arg2 mode, result in r1

06 xx yy mm -> div arg1 arg2 mode, result in r1

07 xx yy 00 -> cmp arg1 arg2 null

08 xx yy zz -> jmp val1 val2 val3, jmp location is generated by concat of val1 val2 val3, 12 54 ab -> jump to location 1254ab

09 xx yy zz -> jmpz val1 val2 val3, see jmp for concat rules

0a xx yy zz -> jmpnz val1 val2 val3, see jmp for concat rules

0b xx mm 00 -> write arg1 mode 00, writes to stdout

0c xx 00 00 -> read arg1 00 00, reads a number or char into arg1

0d xx mm 00 -> hlt arg1 mode 00, halts with return code arg1 or content of arg1, depending on mode

0e xx yy zz -> store arg1 arg2 arg3, move content of register r1 into memory address arg1 + arg2 + arg3, see jmp for concat rules

0e xx yy zz -> load arg1 arg2 arg3, move content of memory address arg1 + arg2 + arg3 into register r1, see jmp for concat rules


### memory

The VM should have some amount bytes of memory, such that `1024 <= mem_size <= infinity`.
